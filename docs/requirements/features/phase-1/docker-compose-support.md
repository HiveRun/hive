# Docker & Compose Support

- [ ] Docker & Compose Support #status/planned #phase-1 #feature/infrastructure

## Goal
Enable constructs to use Docker containers and Docker Compose for services alongside regular process-based services.

## Requirements

### Docker Container Support
- For `type: "docker"` services, Synthetic runs `docker run` with declared `image`, `command` (optional), `ports`, `env`, and `volumes`.
- Port requests pick an open host port, map it to the declared container port, and expose the value through the configured env name.
- Volume paths support `${constructDir}` templating so persistent data lives alongside the construct workspace.
- Docker services use deterministic container names (`synthetic-{constructId}-{serviceName}`) so stop commands can be autogenerated when omitted.

### Docker Compose Integration
- For `type: "compose"`, point to a Compose file (`composePath`) and optional service filter.
- Synthetic parses the Compose file, injects templated variables (including generated ports/env vars), and starts the selected services with the same status tracking/ready detection pipeline.
- When Compose is involved, generated per-service shims expose the same lifecycle hooks (ready pattern, stop) to keep the UI consistent.

### Mixed Service Types
- Support hybrid constructs with both Docker containers and regular processes
- Unified service management across different service types
- Consistent status tracking and lifecycle management
- Proper dependency handling between mixed service types

## UX Requirements

### Docker Configuration Interface
- **Image selection**: Browse and select Docker images with version management
- **Port configuration**: Visual port mapping with conflict detection
- **Volume management**: Interactive volume path configuration with validation
- **Environment variables**: Editor for Docker environment variables with templating support

### Compose File Management
- **Compose file browser**: Select and preview Docker Compose files
- **Service filtering**: UI to select specific services from compose files
- **Variable injection**: Preview how template variables will be resolved
- **Validation feedback**: Real-time validation of compose file syntax

### Service Status Display
- **Container status**: Show running/stopped states for Docker containers
- **Resource usage**: Display CPU, memory, and disk usage for containers
- **Log access**: Easy access to container logs and output
- **Health indicators**: Visual health status for containerized services

## Implementation Details

### Docker Integration
- Docker CLI integration for container lifecycle management
- Container naming and identification system
- Port allocation and mapping logic
- Volume mounting and path resolution

### Compose File Processing
- YAML parsing and validation
- Service dependency resolution
- Variable injection and templating
- Service filtering and selection

### Service Management
- Unified service interface for Docker and process services
- Status tracking across different service types
- Lifecycle hook abstraction
- Health check and ready detection

## Integration Points
- **Template Definition System**: Extends service types to include Docker and Compose
- **Construct Creation/Provisioning**: Handles Docker-specific provisioning steps
- **Service Control**: Provides unified management interface for all service types
- **Agent Orchestration Engine**: Tracks Docker service status alongside other services

## Testing Strategy
- Test Docker container lifecycle and management
- Verify Docker Compose file parsing and execution
- Test mixed service type scenarios
- Validate port allocation and volume mounting
- Test container health monitoring and status tracking
- Performance testing with multiple containers
- Error handling and recovery scenarios

## Testing Strategy
*This section needs to be filled in with specific testing approaches for Docker & Compose functionality.*